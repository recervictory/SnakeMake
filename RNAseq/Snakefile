import glob
import os
import yaml

# Todo: Read Config File
with open("config.yaml", "r") as file:
    params = yaml.safe_load(file)



# Todo: get list of fastq files
samples, reads = glob_wildcards("raw_data/{sample}_{read}.fastq.gz")

print(params['cudaAdapt']['adapter_a'])

rule all:
    input:
        expand('adapter_removed/{sample}_R1.trimmed.fastq.gz', sample=samples),
        expand('adapter_removed/{sample}_R2.trimmed.fastq.gz', sample=samples)

rule fastQC:
    input:
        'raw_data/{sample}_{read}.fastq.gz'
    output:
        directory('fastqc/{sample}_{read}'),
        'fastqc/{sample}_{read}/{sample}_{read}.fastq.html'
    threads: 4
    shell:
        '''
        mkdir -p {output}
        fastqc -t {threads} {input} --outdir {output}
        '''

rule cudaAdapt:
    input:
        read1 = 'raw_data/{sample}_R1.fastq.gz',
        read2 = 'raw_data/{sample}_R2.fastq.gz',
    params:
        adapter_a = params['cudaAdapt']['adapter_a'],
        adapter_A = params['cudaAdapt']['adapter_A'],
        cpu_cores = params['cudaAdapt']['cpu_cores'],
        quality_score_threshold = params['cudaAdapt']['quality_score_threshold'],
        min_length_threshold = params['cudaAdapt']['min_length_threshold']
    output:
        read1='adapter_removed/{sample}_R1.trimmed.fastq.gz',
        read2='adapter_removed/{sample}_R2.trimmed.fastq.gz'
    shell:
        '''
        cudadapt    -a {params.adapter_a} -A {params.adapter_A} 
                    -j {params.cpu_cores} 
                    -q {params.quality_score_threshold} -m {params.min_length_threshold}
                    -o {output.read1} -p {output.read2}
                    {input.read1} {input.read2}
        '''
                    
                